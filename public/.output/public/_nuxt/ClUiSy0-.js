import{_ as K}from"./2d5tmkDm.js";import{_ as L,r as g,l as U,x as Q,c as i,o as n,a as t,J as I,y as E,t as T,K as F,B as q,q as C,C as Z,D as H,E as W,L as X,F as z,n as A,M as Y,A as w,b as k,w as $,s as j,N as G,k as ee,z as te,T as se,v as oe,d as le}from"./FsFn14e0.js";/* empty css        */import{u as P}from"./LQRTUvHo.js";import{u as ne}from"./DRs_EN8N.js";import{u as ae}from"./41ABSLID.js";import"./BJ2ClxiI.js";const re={class:"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white/90 backdrop-blur-md transition-opacity duration-500"},ie={class:"relative flex items-center justify-center w-64 h-64"},de={__name:"SharedBreathingLoader",props:{duration:{type:Number,default:4e3},minCycles:{type:Number,default:1},color:{type:String,default:"#2C3E50"}},emits:["complete"],setup(l,{emit:f}){const p=l,h=f,a=g(!1),v=g("Inspirez...");let c=null,d=null;U(()=>{x()}),Q(()=>{clearInterval(c),clearTimeout(d)});const x=()=>{a.value=!0,v.value="Inspirez...",d=setTimeout(()=>{a.value=!1,v.value="Expirez..."},p.duration/2),setTimeout(()=>{h("complete")},p.duration)};return(y,S)=>(n(),i("div",re,[t("div",ie,[t("div",{class:E(["absolute rounded-full blur-2xl transition-all duration-[4000ms] ease-in-out",{"w-64 h-64 opacity-100":a.value,"w-16 h-16 opacity-30":!a.value}]),style:I({backgroundColor:`${l.color}20`})},null,6),t("div",{class:E(["absolute rounded-full transition-all duration-[4000ms] ease-in-out border",{"w-48 h-48":a.value,"w-12 h-12":!a.value}]),style:I({backgroundColor:`${l.color}40`,borderColor:`${l.color}20`})},null,6),t("p",{class:"relative z-10 font-serif text-xl font-light tracking-widest transition-opacity duration-1000",style:I({color:l.color})},T(v.value),5)]),t("div",{class:"mt-8 font-light text-sm tracking-wide animate-pulse",style:I({color:`${l.color}80`})}," Laissez le temps au temps... ",4)]))}},ue=L(de,[["__scopeId","data-v-d8523622"]]),ce={class:"relative p-6 bg-white rounded-2xl border border-stone-100 shadow-sm hover:shadow-md transition-all"},me={class:"flex justify-between items-start mb-4"},fe={class:"text-[#2C3E50] font-serif text-xl font-bold tracking-wide"},ve={key:0,class:"text-green-600 text-xs font-bold uppercase tracking-widest bg-green-50 border border-green-100 px-2 py-1 rounded"},pe={class:"text-stone-600 font-light leading-relaxed mb-6"},xe={key:0,class:"text-center py-2"},ge=["disabled"],he=["disabled"],ye={key:0,class:"animate-pulse"},be={key:1},_e={key:0,class:"text-red-500 text-xs text-center mt-1"},we={__name:"GrimoireEnigmaCard",props:{enigmaId:{type:String,required:!0},question:{type:String,required:!0},initiallySolved:{type:Boolean,default:!1},themeColor:{type:String,default:"#2C3E50"}},emits:["unlocked"],setup(l,{emit:f}){const p=l,h=f,a=g(""),v=g(!1),c=g(!1),d=g(null),x=g(""),y=g(p.initiallySolved);F(()=>p.initiallySolved,r=>{r&&(y.value=!0)});const S=async()=>{v.value=!0,c.value=!0,x.value="",d.value=null;try{const r=A(),m=P("auth_token").value,b=fetch(`${r.public.apiBase}/enigmas/verify`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:m?`Bearer ${m}`:""},body:JSON.stringify({id:p.enigmaId,answer:a.value})});d.value=await b.then(_=>_.json()).then(_=>({success:!0,data:_})).catch(_=>({success:!1,err:_}))}catch(r){d.value={success:!1,err:r}}},B=()=>{if(c.value=!1,v.value=!1,d.value)if(d.value.success){const r=d.value.data;if(r.success){y.value=!0;const m=r.reward,b={id:p.enigmaId,url:m.fragment_svg_path,x:m.x,y:m.y,width:m.width,zIndex:m.zIndex};h("unlocked",b)}else x.value="La rÃ©ponse n'est pas celle attendue par le totem."}else console.error(d.value.err),x.value="Les esprits semblent perturbÃ©s (Erreur serveur).";else x.value="Pas de rÃ©ponse des esprits..."};return(r,m)=>(n(),i(z,null,[t("div",ce,[t("div",me,[t("h3",fe," Ã‰nigme #"+T(l.enigmaId),1),y.value?(n(),i("span",ve," RÃ©solu ")):C("",!0)]),t("p",pe,T(l.question),1),y.value?(n(),i("div",xe,[...m[1]||(m[1]=[t("p",{class:"text-[#2C3E50] italic font-serif opacity-70"},`"Le fragment s'est rÃ©vÃ©lÃ©..."`,-1)])])):(n(),i("form",{key:1,onSubmit:Z(S,["prevent"]),class:"flex flex-col gap-4"},[H(t("input",{"onUpdate:modelValue":m[0]||(m[0]=b=>a.value=b),type:"text",placeholder:"Votre rÃ©ponse...",class:"w-full bg-stone-50 border border-stone-200 text-[#2C3E50] px-4 py-3 rounded-xl focus:ring-2 focus:ring-[#2C3E50]/20 focus:border-[#2C3E50] outline-none transition-all placeholder-stone-400",disabled:v.value},null,8,ge),[[W,a.value]]),t("button",{type:"submit",disabled:!a.value||v.value,class:"w-full py-3 bg-[#2C3E50] text-white font-bold rounded-xl hover:bg-[#34495E] disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md active:scale-[0.98]"},[v.value?(n(),i("span",ye,"Invocation...")):(n(),i("span",be,"Invoquer"))],8,he),x.value?(n(),i("p",_e,T(x.value),1)):C("",!0)],32))]),(n(),q(X,{to:"body"},[c.value?(n(),q(ue,{key:0,duration:4e3,color:l.themeColor,onComplete:B},null,8,["color"])):C("",!0)]))],64))}},R=Y("grimoire",{state:()=>({unlockedFragments:[]}),actions:{unlockFragment(l){this.unlockedFragments.find(f=>f.id===l.id)||this.unlockedFragments.push(l)},isUnlocked(l){return!!this.unlockedFragments.find(f=>f.id===l)}}}),ke={key:0,class:"w-full h-full p-8 animate-fade-in duration-1000"},Ce=["src"],Ie={key:1,class:"text-center opacity-40 select-none pointer-events-none"},$e={key:2,class:"relative w-full h-full flex justify-center items-center p-4"},Te={class:"relative h-full aspect-[2/3]"},Ee=["src"],Se={__name:"GrimoireTotemCanvas",props:{scale:{type:Number,default:1},isCompleted:{type:Boolean,default:!1},totemId:{type:Number,required:!0},completedImage:{type:String,required:!0},heightClass:{type:String,default:"h-[600px]"}},setup(l){const f=l,p=R(),h=w(()=>p.unlockedFragments.filter(a=>a.totemId===f.totemId));return(a,v)=>(n(),i("div",{class:E(["relative w-full flex items-center justify-center bg-stone-50/50 rounded-2xl border border-stone-100 overflow-hidden",l.heightClass])},[l.isCompleted?(n(),i("div",ke,[t("img",{src:l.completedImage,alt:"Totem Complet",class:"w-full h-full object-contain drop-shadow-2xl"},null,8,Ce)])):h.value.length===0?(n(),i("div",Ie,[...v[0]||(v[0]=[t("div",{class:"text-6xl mb-4 grayscale opacity-50"},"ðŸ”®",-1),t("p",{class:"font-serif text-stone-400"},"Totem endormi...",-1)])])):(n(),i("div",$e,[t("div",Te,[k(G,{name:"totem"},{default:$(()=>[(n(!0),i(z,null,j(h.value,c=>(n(),i("div",{key:c.id,class:"absolute transition-all duration-1000 ease-out flex justify-center",style:I({top:`${c.y}%`,left:"50%",transform:"translate(-50%, 0)",zIndex:c.zIndex,width:c.width?`${c.width*l.scale}px`:`${100*l.scale}px`})},[t("img",{src:c.url,class:"w-full h-auto",style:{filter:"drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1))"},alt:"Totem Fragment"},null,8,Ee)],4))),128))]),_:1})])]))],2))}},ze=L(Se,[["__scopeId","data-v-12393e99"]]),Be={class:"min-h-screen text-[#2C3E50] font-sans"},Fe={class:"container mx-auto px-6 py-12 flex flex-col lg:flex-row gap-12 items-start justify-center min-h-screen"},qe={class:"w-full lg:w-5/12 h-auto z-10 flex flex-col order-2 lg:order-1 sticky top-12"},je={class:"bg-white rounded-3xl w-full flex flex-col overflow-hidden divide-y divide-stone-100 shadow-sm border border-stone-100"},Le=["onClick"],Ne={key:0,class:"absolute left-0 top-0 bottom-0 w-2 bg-[#2C3E50]"},Me={class:"w-full relative"},Ue={class:"w-full lg:w-6/12 flex flex-col gap-8 order-1 lg:order-2"},Ae={class:"mb-4"},Ge={class:"text-lg text-stone-500 leading-relaxed border-l-4 border-[#2C3E50] pl-4 py-1 italic mb-4"},Pe={key:"empty",class:"text-center py-12 text-stone-400 italic"},Re={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/30 backdrop-blur-md"},Ve={class:"bg-white p-12 max-w-lg w-full text-center rounded-3xl transform scale-100 animate-[bounce-in_0.5s_ease-out] shadow-2xl"},De={class:"flex flex-col gap-3"},Je={__name:"grimoire",async setup(l){let f,p;const h=ee(),a=R(),{totemMetadata:v}=ne(),c=A(),{data:d}=([f,p]=te(()=>ae(`${c.public.apiBase}/enigmas`,"$biZPAlTBUP")),f=await f,p(),f),x=P("auth_token"),y=w(()=>d.value?[...new Set(d.value.map(e=>e.totem_id||1))].sort((e,u)=>e-u).map(e=>{const u=v[e];return{id:e,name:u?.name||`Totem #${e}`,image:u?.image||"",description:u?.description||"Un nouveau mystÃ¨re Ã  rÃ©soudre."}}):[]),S={1:"#10B981",2:"#F59E0B",3:"#3B82F6",4:"#8B5CF6",5:"#EC4899",6:"#6366F1"},B=w(()=>S[r.value]||"#2C3E50"),r=g(1);F(y,s=>{const e=Array.isArray(h.query.totemId)?h.query.totemId[0]:h.query.totemId,u=parseInt(e);u&&s.find(o=>o.id===u)?r.value=u:s.length>0&&!s.find(o=>o.id===r.value)&&(r.value=s[0].id)},{immediate:!0});const m=w(()=>y.value.find(s=>s.id===r.value)||y.value[0]||{}),b=w(()=>d.value?d.value.filter(s=>(s.totem_id||1)==r.value).sort((s,e)=>s.id-e.id):[]),_=g(!1),N=g(!0),V=w(()=>b.value.length===0?!1:b.value.every(s=>a.isUnlocked(s.id))),D=s=>{const e=d.value?d.value.filter(u=>(u.totem_id||1)===s):[];return e.length===0?!1:e.every(u=>a.isUnlocked(u.id))};F(V,(s,e)=>{s&&!e&&!N.value&&(_.value=!0)}),U(async()=>{if(x.value)try{const s=await fetch(`${c.public.apiBase}/user/profile`,{headers:{Authorization:`Bearer ${x.value}`}});if(s.ok){const e=await s.json();e.unlockedFragments&&d.value&&e.unlockedFragments.forEach(u=>{const o=d.value.find(M=>M.reward.fragment_id===u.fragmentId);o&&a.unlockFragment({id:o.id,totemId:o.totem_id||1,url:o.reward.fragment_svg_path,x:o.reward.x,y:o.reward.y,width:o.reward.width,zIndex:o.reward.zIndex})})}}catch(s){console.error("Failed to restore grimoire progress",s)}setTimeout(()=>{N.value=!1},500)});const J=()=>{_.value=!1},O=s=>{const e=d.value.find(u=>u.id===s.id);e?a.unlockFragment({...s,totemId:e.totem_id||1}):a.unlockFragment(s)};return(s,e)=>{const u=K;return n(),i("div",Be,[t("div",Fe,[t("div",qe,[t("div",je,[e[0]||(e[0]=t("div",{class:"p-6 pb-2 text-center border-b border-stone-50"},[t("h2",{class:"font-serif text-3xl text-[#2C3E50] font-bold"},"Totems")],-1)),(n(!0),i(z,null,j(y.value,o=>(n(),i("div",{key:o.id,onClick:M=>r.value=o.id,class:E(["relative p-6 flex flex-col items-center cursor-pointer transition-all duration-300",r.value===o.id?"bg-stone-50":"hover:bg-stone-50/50"])},[r.value===o.id?(n(),i("div",Ne)):C("",!0),t("div",Me,[k(ze,{totemId:o.id,completedImage:o.image,scale:2,heightClass:"h-[300px]",isCompleted:D(o.id),class:E(["transition-opacity duration-300",r.value===o.id?"opacity-100":"opacity-70 grayscale-[0.5]"])},null,8,["totemId","completedImage","isCompleted","class"])])],10,Le))),128))])]),t("div",Ue,[t("div",Ae,[e[2]||(e[2]=t("h1",{class:"text-4xl md:text-5xl font-serif font-bold text-[#2C3E50] mb-4"},"Le Grimoire",-1)),t("p",Ge,' "'+T(m.value.description)+'" ',1),k(u,{to:`/map?focusTotem=${r.value}`,class:"inline-flex items-center gap-2 px-4 py-2 bg-stone-100 hover:bg-stone-200 text-stone-600 rounded-full text-sm font-bold transition-colors"},{default:$(()=>[...e[1]||(e[1]=[t("span",null,"ðŸ“ Localiser le Sanctuaire",-1)])]),_:1},8,["to"])]),k(G,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"transform translate-y-10 opacity-0","leave-active-class":"absolute opacity-0 hidden",tag:"div",class:"flex flex-col gap-6 relative"},{default:$(()=>[(n(!0),i(z,null,j(b.value,o=>(n(),q(we,{key:o.id,enigmaId:o.id,question:o.question,initiallySolved:oe(a).isUnlocked(o.id),themeColor:B.value,onUnlocked:O},null,8,["enigmaId","question","initiallySolved","themeColor"]))),128)),b.value.length===0?(n(),i("div",Pe," Aucune Ã©nigme trouvÃ©e pour ce totem. ")):C("",!0)]),_:1})])]),k(se,null,{default:$(()=>[_.value?(n(),i("div",Re,[t("div",Ve,[e[4]||(e[4]=t("div",{class:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),t("path",{d:"m9 12 2 2 4-4"})])],-1)),e[5]||(e[5]=t("h2",{class:"text-3xl font-serif text-[#2C3E50] font-bold mb-4"},"Le Totem est Complet !",-1)),e[6]||(e[6]=t("p",{class:"text-stone-600 mb-8 leading-relaxed"}," Vous avez rassemblÃ© tous les fragments. L'esprit de la ville est rÃ©veillÃ©. ",-1)),e[7]||(e[7]=t("div",{class:"p-4 bg-stone-50 rounded-xl border border-stone-100 mb-8"},[t("p",{class:"text-[#2C3E50] font-bold flex items-center justify-center gap-2"}," âœ¨ Le Totem a Ã©tÃ© ajoutÃ© Ã  votre profil ")],-1)),t("div",De,[k(u,{to:"/profile",class:"w-full py-4 bg-[#2C3E50] text-white rounded-xl font-bold hover:bg-[#34495E] hover:scale-105 transition-all shadow-lg"},{default:$(()=>[...e[3]||(e[3]=[le(" Voir mon Profil ",-1)])]),_:1}),t("button",{onClick:J,class:"text-stone-400 text-sm hover:text-stone-600 underline mt-2"}," Rester sur le Grimoire ")])])])):C("",!0)]),_:1})])}}},Ye=L(Je,[["__scopeId","data-v-b9d2ba7e"]]);export{Ye as default};
