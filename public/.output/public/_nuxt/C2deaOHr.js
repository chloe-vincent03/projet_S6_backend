import{_ as E}from"./CMZabeNq.js";import{g as k,r as l,c as p,a as t,C as S,q as N,D as g,E as x,v as s,G as y,t as j,d as _,b as T,w as V,o as m,n as D,H as w}from"./17CJ-4L8.js";import{u as O}from"./HbBEbhl-.js";import"./BJ2ClxiI.js";const B={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#f4f6fb] to-[#e9ecf5] p-4 font-sans"},M={class:"w-full max-w-md bg-white rounded-2xl p-8 shadow-[0_20px_40px_rgba(0,0,0,0.08)]"},q={class:"flex flex-col gap-1.5"},A={class:"flex flex-col gap-1.5"},J={class:"flex flex-col gap-1.5"},R={key:0,class:"text-red-500 text-sm text-center bg-red-50 p-2 rounded"},U={class:"flex flex-col items-center gap-4 mt-4"},L=["disabled"],P={key:0},$={key:1},z={class:"text-sm text-gray-600"},Q=k({__name:"register",setup(G){const i=l(""),r=l(""),n=l(""),d=l(!1),u=l(""),b=D();async function C(){d.value=!0,u.value="";try{const a={username:i.value,email:r.value,password:n.value},e=await fetch(`${b.public.apiBase}/user/register`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)}),c=await e.text();let o;try{o=JSON.parse(c)}catch{throw console.error("Réponse non-JSON reçue:",c),new Error(`Le serveur a renvoyé une réponse invalide (${e.status}). Vérifiez la console pour les détails.`)}if(!e.ok)throw new Error(o.message||"Erreur lors de l'inscription");const v=await fetch(`${b.public.apiBase}/user/login`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:r.value,password:n.value})}),f=await v.json();if(!v.ok){console.warn("Auto-login failed:",f.message),await w("/login");return}if(f.token){const h=O("auth_token",{maxAge:86400});h.value=f.token,await w("/map")}else await w("/login")}catch(a){console.error("Erreur inscription:",a),u.value=a.message||"Une erreur est survenue lors de l'inscription."}finally{d.value=!1}}return(a,e)=>{const c=E;return m(),p("div",B,[t("div",M,[e[8]||(e[8]=t("h1",{class:"text-3xl font-bold text-center mb-8",style:{color:"#2C3E50"}}," Créer un compte ",-1)),t("form",{class:"flex flex-col gap-5",onSubmit:S(C,["prevent"])},[t("div",q,[e[3]||(e[3]=t("label",{for:"username",class:"text-sm font-medium text-gray-700"}," Nom d'utilisateur ",-1)),g(t("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=o=>y(i)?i.value=o:null),type:"text",placeholder:"Pseudo",required:"",class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 outline-none transition-all placeholder-gray-400",style:{"accent-color":"#2C3E50","caret-color":"#2C3E50"}},null,512),[[x,s(i)]])]),t("div",A,[e[4]||(e[4]=t("label",{for:"email",class:"text-sm font-medium text-gray-700"}," Email ",-1)),g(t("input",{id:"email","onUpdate:modelValue":e[1]||(e[1]=o=>y(r)?r.value=o:null),type:"email",placeholder:"exemple@test.com",required:"",class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 outline-none transition-all placeholder-gray-400",style:{"accent-color":"#2C3E50","caret-color":"#2C3E50"}},null,512),[[x,s(r)]])]),t("div",J,[e[5]||(e[5]=t("label",{for:"password",class:"text-sm font-medium text-gray-700"}," Mot de passe ",-1)),g(t("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=o=>y(n)?n.value=o:null),type:"password",placeholder:"Mot de passe",required:"",class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 outline-none transition-all placeholder-gray-400",style:{"accent-color":"#2C3E50","caret-color":"#2C3E50"}},null,512),[[x,s(n)]])]),s(u)?(m(),p("div",R,j(s(u)),1)):N("",!0),t("div",U,[t("button",{type:"submit",disabled:s(d),class:"w-full py-3 px-4 disabled:bg-gray-400 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5 flex justify-center items-center",style:{"background-color":"#2C3E50"}},[s(d)?(m(),p("span",P,"Inscription...")):(m(),p("span",$,"S'inscrire"))],8,L),t("p",z,[e[7]||(e[7]=_(" Déjà un compte ? ",-1)),T(c,{to:"/login",class:"font-medium hover:underline transition-colors",style:{color:"#2C3E50"}},{default:V(()=>[...e[6]||(e[6]=[_(" Se connecter ",-1)])]),_:1})])])],32)])])}}});export{Q as default};
