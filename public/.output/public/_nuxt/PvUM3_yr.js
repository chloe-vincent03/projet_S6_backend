import{_ as D}from"./2d5tmkDm.js";import{g as H,j as L,z as _,A as b,r as O,c as l,v as h,a as e,b as f,w as m,t as v,q as w,T as q,F as R,s as G,n as U,o as n,d as g,y as W}from"./FsFn14e0.js";import{u as J}from"./LQRTUvHo.js";import{u as K}from"./DRs_EN8N.js";import{u as k}from"./41ABSLID.js";import"./BJ2ClxiI.js";const Q={class:"min-h-screen bg-[#e9ecf5] flex items-center justify-center p-6"},X={key:0,class:"text-stone-500 animate-pulse"},Y={key:1,class:"text-center"},Z={key:2,class:"w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden border border-stone-100"},ee={class:"h-32 bg-[#2C3E50] relative overflow-hidden"},te={class:"px-8 pb-8 -mt-16 relative z-10"},oe={class:"text-center mb-8"},se={class:"text-2xl font-serif font-bold text-[#2C3E50]"},le={class:"text-stone-500 text-sm"},ne={class:"grid grid-cols-2 gap-4 mb-8"},re={class:"bg-stone-50 p-4 rounded-2xl text-center border border-stone-100"},ae={class:"block text-3xl font-bold text-[#2C3E50] mb-1"},ie={class:"bg-stone-50 p-4 rounded-2xl text-center border border-stone-100"},de={class:"block text-3xl font-bold text-[#2C3E50] mb-1"},ue={class:"mb-8"},ce={class:"bg-stone-50 rounded-2xl p-4 border border-stone-100"},pe={class:"relative w-full aspect-[2/3] bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden group"},fe={key:0,class:"relative w-full h-full"},me=["src","alt"],ve={class:"absolute bottom-4 bg-white/90 px-4 py-2 rounded-full shadow-sm"},be={class:"text-sm font-bold text-stone-600 font-serif"},he={key:2,class:"absolute bottom-1 w-full flex justify-center gap-2 pb-2"},ge=["onClick"],xe={key:1,class:"w-full h-full flex flex-col items-center justify-center text-center p-6 text-stone-400"},_e={class:"space-y-4"},$e=H({__name:"profile",async setup(we){let o,c;const x=U(),y=J("auth_token"),B=L(),{getTotemMetadata:$}=K(),{data:d,pending:A,error:S}=([o,c]=_(()=>k(`${x.public.apiBase}/user/profile`,{headers:{Authorization:`Bearer ${y.value}`}},"$-6sbaO0toW")),o=await o,c(),o),{data:C}=([o,c]=_(()=>k(`${x.public.apiBase}/enigmas`,"$pH-0-4vmPi")),o=await o,c(),o),E=b(()=>!d.value||!d.value.progress?0:d.value.progress.filter(i=>i.isCompleted).length),{data:T}=([o,c]=_(()=>k(`${x.public.apiBase}/places`,"$IqgAbfvMHU")),o=await o,c(),o),j=b(()=>T.value?.length||0),N=b(()=>j.value===0?0:Math.round(E.value/j.value*100)),s=O(0),F=()=>{s.value<a.value.length-1?s.value++:s.value=0},I=()=>{s.value>0?s.value--:s.value=a.value.length-1},a=b(()=>{if(!C.value||!d.value?.unlockedFragments)return[];const i={};C.value.forEach(r=>{const u=r.totem_id||1;i[u]||(i[u]=[]),r.reward&&r.reward.fragment_id&&i[u].push(r.reward.fragment_id)});const t=[];return Object.keys(i).forEach(r=>{const u=Number(r),p=i[u]||[];if(p.length===0)return;p.every(P=>d.value.unlockedFragments.some(V=>String(V.fragmentId)===String(P)))&&t.push($(u))}),t}),M=()=>{y.value=null,B.push("/login")};return(i,t)=>{const r=D;return n(),l("div",Q,[h(A)?(n(),l("div",X,"Chargement du profil...")):h(S)?(n(),l("div",Y,[t[1]||(t[1]=e("p",{class:"text-red-500 font-bold mb-4"},"Impossible de charger le profil",-1)),f(r,{to:"/login",class:"text-[#2C3E50] underline"},{default:m(()=>[...t[0]||(t[0]=[g("Se reconnecter",-1)])]),_:1})])):(n(),l("div",Z,[e("div",ee,[t[3]||(t[3]=e("div",{class:"absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white via-transparent to-transparent"},null,-1)),f(r,{to:"/",class:"absolute top-6 left-6 text-white/80 hover:text-white transition-colors bg-white/10 backdrop-blur-md px-3 py-1 rounded-full text-sm font-medium"},{default:m(()=>[...t[2]||(t[2]=[g(" â† Accueil ",-1)])]),_:1})]),e("div",te,[t[10]||(t[10]=e("div",{class:"w-32 h-32 mx-auto bg-stone-100 rounded-full border-4 border-white shadow-md flex items-center justify-center text-[#2C3E50] mb-6"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})])],-1)),e("div",oe,[e("h1",se,v(h(d).username||"Explorateur"),1),e("p",le,v(h(d).email),1)]),e("div",ne,[e("div",re,[e("span",ae,v(E.value),1),t[4]||(t[4]=e("span",{class:"text-xs text-stone-500 uppercase tracking-widest font-bold"},"Lieux DÃ©couverts",-1))]),e("div",ie,[e("span",de,v(N.value)+"%",1),t[5]||(t[5]=e("span",{class:"text-xs text-stone-500 uppercase tracking-widest font-bold"},"Progression",-1))])]),e("div",ue,[t[7]||(t[7]=e("h3",{class:"text-[#2C3E50] font-serif font-bold text-lg mb-4 flex items-center gap-2"}," Mes Totems ",-1)),e("div",ce,[e("div",pe,[a.value.length>0?(n(),l("div",fe,[f(q,{name:"fade",mode:"out-in"},{default:m(()=>[(n(),l("div",{key:s.value,class:"w-full h-full relative flex flex-col items-center justify-center p-4 animate-fade-in"},[e("img",{src:a.value[s.value].image,alt:a.value[s.value].name,class:"w-full h-full object-contain p-4 drop-shadow-xl"},null,8,me),e("div",ve,[e("span",be,v(a.value[s.value].name),1)])]))]),_:1}),a.value.length>1?(n(),l("button",{key:0,onClick:I,class:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full shadow text-stone-600 hover:text-stone-900 transition-all opacity-0 group-hover:opacity-100"}," â® ")):w("",!0),a.value.length>1?(n(),l("button",{key:1,onClick:F,class:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full shadow text-stone-600 hover:text-stone-900 transition-all opacity-0 group-hover:opacity-100"}," â¯ ")):w("",!0),a.value.length>1?(n(),l("div",he,[(n(!0),l(R,null,G(a.value,(u,p)=>(n(),l("button",{key:p,onClick:z=>s.value=p,class:W(["w-2 h-2 rounded-full transition-all",s.value===p?"bg-stone-600 w-4":"bg-stone-300 hover:bg-stone-400"])},null,10,ge))),128))])):w("",!0)])):(n(),l("div",xe,[...t[6]||(t[6]=[e("div",{class:"text-4xl mb-2 opacity-30"},"ðŸ”®",-1),e("p",{class:"italic text-sm"},"Aucun totem complÃ©tÃ© pour l'instant.",-1)])]))])])]),e("div",_e,[f(r,{to:"/map",class:"block w-full py-4 bg-[#2C3E50] text-white text-center rounded-xl font-bold hover:bg-[#34495E] hover:scale-[1.02] transition-all shadow-lg"},{default:m(()=>[...t[8]||(t[8]=[g(" AccÃ©der Ã  la Carte ",-1)])]),_:1}),f(r,{to:"/grimoire",class:"block w-full py-4 border-2 border-[#2C3E50] text-[#2C3E50] text-center rounded-xl font-bold hover:bg-stone-50 hover:scale-[1.02] transition-all shadow-sm"},{default:m(()=>[...t[9]||(t[9]=[g(" Ouvrir le Grimoire ",-1)])]),_:1}),e("button",{onClick:M,class:"block w-full py-4 border border-red-200 text-red-500 rounded-xl font-bold hover:bg-red-50 transition-colors"}," DÃ©connexion ")])])]))])}}});export{$e as default};
